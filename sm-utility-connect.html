<link rel="import" href="../polymer/polymer.html"> <link rel="import" href="../iron-ajax/iron-ajax.html"> <link rel="import" href="../sm-utility-auth/sm-utility-auth.html"> <link rel="import" href="../object-assign/object-assign.html"> <dom-module id="sm-utility-connect"> <template> <iron-ajax id="post" method="PUT" loading="{{saving}}" headers="[[headers]]" url="[[endpoint]]" body="[[value]]" handle-as="json" content-type="application/json" on-response="_savedHandler" on-error="_errorHandler" debounce-duration="300"></iron-ajax> <iron-ajax id="get" method="GET" loading="{{loading}}" headers="[[headers]]" url="[[endpoint]]" handle-as="json" last-response="{{value}}" on-response="_loadedHandler" on-error="_errorHandler" debounce-duration="300"></iron-ajax> <sm-utility-auth token="{{token}}"></sm-utility-auth> </template> <script>!function(){"use strict";function e(e){var a,o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],s=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],u=arguments.length<=3||void 0===arguments[3]?{}:arguments[3];return{properties:{uid:Object.assign({},n,o),saving:Object.assign({},i,s),loading:Object.assign({},r,u)},created:function(){window.simpla.elements=window.simpla.elements||[],window.simpla.elements.push(this)},listeners:(a={},t.defineProperty(a,e+".saved","_fireSaved"),t.defineProperty(a,e+".loaded","_fireLoaded"),t.defineProperty(a,e+".error","_fireError"),t.defineProperty(a,e+".error","_removeValue"),a),save:function(){var t=void 0,n=void 0;return"function"!=typeof this._toObject?void console.warn(this.localName+" must implement _toObject()"):"function"!=typeof this._equal?void console.warn(this.localName+" must implement _equal()"):(t=this.$[e].value,n=this._toObject(),this._equal(n,t)?!1:(this.$[e].value=this._toObject(),this.$[e].save(),!0))},load:function(){this.$[e].load()},_fireSaved:function(e){this.fire("saved",e.detail,{bubbles:!1})},_fireLoaded:function(e){this.fire("loaded",e.detail,{bubbles:!1})},_fireError:function(e){this.fire("error",e.detail,{bubbles:!1})},_removeValue:function(t){this.$[e].value=null}}}var t={};t.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t.createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),t.defineProperty=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e};var n={type:String},i={type:Boolean,value:!1,reflectToAttribute:!0},r={type:Boolean,value:!1,reflectToAttribute:!0},a=function(){function e(){t.classCallCheck(this,e)}return t.createClass(e,[{key:"beforeRegister",value:function(){this.is="sm-utility-connect",this.properties={value:{type:Object,notify:!0},server:String,key:String,api:String,endpoint:{computed:"_computeEndpoint(server, key, api)"},token:String,headers:{computed:"_computeHeaders(token)"},activeSaveRequests:{type:Array,value:function(){return[]}},activeLoadRequests:{type:Array,value:function(){return[]}},saving:{type:Boolean,notify:!0,value:!1},loading:{type:Boolean,notify:!0,value:!1}}}},{key:"ready",value:function(){this.server=window.simpla.config.server,this.api=window.simpla.config.api}},{key:"load",value:function(){this.$.get.generateRequest()}},{key:"save",value:function(){this.$.post.generateRequest()}},{key:"_computeEndpoint",value:function(e,t,n){var i=encodeURIComponent(t);return e+"/projects/"+n+"/items/"+i}},{key:"_computeHeaders",value:function(e){return e?{Authorization:"Bearer "+e}:{}}},{key:"_savedHandler",value:function(){this.fire("saved",{value:this.value},{bubbles:!1})}},{key:"_loadedHandler",value:function(){this.fire("loaded",{value:this.value},{bubbles:!1})}},{key:"_errorHandler",value:function(e){this.fire("error",e.detail)}}]),e}();Polymer(a),window.simpla=window.simpla||{},window.simpla.behaviors=window.simpla.behaviors||{},window.simpla.behaviors.persists=e}();</script></dom-module>