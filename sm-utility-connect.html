<link rel="import" href="../polymer/polymer.html"> <link rel="import" href="../iron-ajax/iron-ajax.html"> <link rel="import" href="../object-assign/object-assign.html"> <dom-module id="sm-utility-connect"> <template> <iron-ajax id="post" method="PUT" loading="{{saving}}" headers="[[headers]]" url="[[endpoint]]" body="[[value]]" handle-as="json" content-type="application/json" on-response="_savedHandler" on-error="_errorHandler" debounce-duration="300"></iron-ajax> <iron-ajax id="get" method="GET" loading="{{loading}}" headers="[[headers]]" url="[[endpoint]]" handle-as="json" last-response="{{value}}" on-response="_loadedHandler" on-error="_errorHandler" debounce-duration="300"></iron-ajax> </template> <script>!function(){"use strict";function e(e){var t,i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],u=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],s=arguments.length<=3||void 0===arguments[3]?{}:arguments[3];return{properties:{uid:Object.assign({},o,i),saving:Object.assign({},r,u),loading:Object.assign({},a,s)},created:function(){window.simpla.elements=window.simpla.elements||[],window.simpla.elements.push(this)},listeners:(t={},n(t,e+".saved","_fireSaved"),n(t,e+".loaded","_fireLoaded"),n(t,e+".error","_fireError"),n(t,e+".error","_removeValue"),t),save:function(){var t=void 0,i=void 0;return"function"!=typeof this._toObject?void console.warn(this.localName+" must implement _toObject()"):"function"!=typeof this._equal?void console.warn(this.localName+" must implement _equal()"):(t=this.$[e].value,i=this._toObject(),!this._equal(i,t)&&(this.$[e].value=this._toObject(),this.$[e].save(),!0))},load:function(){this.$[e].load()},_fireSaved:function(e){this.fire("saved",e.detail,{bubbles:!1})},_fireLoaded:function(e){this.fire("loaded",e.detail,{bubbles:!1})},_fireError:function(e){this.fire("error",e.detail,{bubbles:!1})},_removeValue:function(t){this.$[e].value=null}}}var t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),n=function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e},o={type:String},r={type:Boolean,value:!1,reflectToAttribute:!0},a={type:Boolean,value:!1,reflectToAttribute:!0},u=function(){function e(){t(this,e)}return i(e,[{key:"beforeRegister",value:function(){this.is="sm-utility-connect",this.properties={value:{type:Object,notify:!0},server:String,key:String,api:String,endpoint:{computed:"_computeEndpoint(server, key, api)"},token:{type:String,value:function(){return Simpla.getState().token}},headers:{computed:"_computeHeaders(token)"},activeSaveRequests:{type:Array,value:function(){return[]}},activeLoadRequests:{type:Array,value:function(){return[]}},saving:{type:Boolean,notify:!0,value:!1},loading:{type:Boolean,notify:!0,value:!1}}}},{key:"created",value:function(){var e=this;Simpla.observe("token",function(t){return e.token=t})}},{key:"ready",value:function(){this.server=window.simpla.config.server,this.api=window.simpla.config.api}},{key:"load",value:function(){this.$.get.generateRequest()}},{key:"save",value:function(){this.$.post.generateRequest()}},{key:"_computeEndpoint",value:function(e,t,i){var n=encodeURIComponent(t);return e+"/projects/"+i+"/items/"+n}},{key:"_computeHeaders",value:function(e){return e?{Authorization:"Bearer "+e}:{}}},{key:"_savedHandler",value:function(){this.fire("saved",{value:this.value},{bubbles:!1})}},{key:"_loadedHandler",value:function(){this.fire("loaded",{value:this.value},{bubbles:!1})}},{key:"_errorHandler",value:function(e){this.fire("error",e.detail)}}]),e}();Polymer(u),window.simpla=window.simpla||{},window.simpla.behaviors=window.simpla.behaviors||{},window.simpla.behaviors.persists=e}()</script> </dom-module>